{% extends 'ligas/base_admin.html' %}
{% block title %}Fixture {{ torneo.nombre }}{% endblock %}
{% block breadcrumbs %}<a href="/">Inicio</a> / Fixture{% endblock %}
{% block header %}Fixture - {{ torneo.nombre }}{% endblock %}
{% block subtitle %}{{ torneo.liga }}{% endblock %}
{% block actions %}
  {% if not fixture_exists and can_create_fixture %}
    <form method="post" action="{{ create_url }}">
      {% csrf_token %}
      <button type="submit" class="btn primary">Crear fixture</button>
    </form>
  {% endif %}
{% endblock %}
{% block content %}
  {% if fixture_exists %}
    {% for ronda in fixture %}
      <div class="fixture-ronda">
        <h2 style="margin-top:0;">{{ ronda.label }}</h2>
        {% if ronda.fechas %}
          {% for fecha in ronda.fechas %}
            <div class="fixture-fecha">
              <h3>Fecha {{ fecha.numero }}</h3>
              <ul class="fixture-partidos">
                {% for partido in fecha.partidos %}
                  <li class="fixture-partido">
                    <div class="teams">
                      <strong>{{ partido.local }}</strong> vs <strong>{{ partido.visitante }}</strong>
                    </div>
                    <div class="status">
                      {% if partido.played %}
                        <span class="badge success">Jugado</span>
                        <span class="score">{{ partido.goles_local }} - {{ partido.goles_visitante }}</span>
                      {% else %}
                        <span class="badge">Pendiente</span>
                      {% endif %}
                    </div>
                  </li>
                {% empty %}
                  <li class="fixture-partido empty">No hay partidos programados.</li>
                {% endfor %}
              </ul>
              {% if fecha.libres %}
                <p class="muted">Libre: {% for eq in fecha.libres %}{{ eq }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
              {% endif %}
            </div>
          {% endfor %}
        {% else %}
          <p class="muted">Esta ronda aún no tiene fechas generadas.</p>
        {% endif %}
        <hr>
      </div>
    {% endfor %}
  {% else %}
    <p>Este torneo todavía no tiene un fixture generado.</p>
    {% if can_create_fixture %}
      <p>Presioná <strong>Crear fixture</strong> para generar las dos rondas automáticamente.</p>
    {% else %}
      <p class="muted">Necesitás permisos para generar el fixture.</p>
    {% endif %}
  {% endif %}
{% endblock %}
